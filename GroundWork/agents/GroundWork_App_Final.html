<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GroundWork â€” Geek Certified</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:     #0A0C10;
  --surf:   #111318;
  --brd:    #1E2128;
  --brd2:   #2A2F3A;
  --text:   #E8EAF0;
  --muted:  #B0BBCC;
  --muted2: #8090A0;
  --teal:   #00C4B8;
  --gold:   #C9A84C;
  --green:  #22C55E;
  --orange: #F05A28;
  --red:    #EF4444;
}

html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif; font-size: 15px; }

/* â”€â”€ TOPBAR â”€â”€ */
.topbar {
  background: var(--surf);
  border-bottom: 1px solid var(--brd);
  height: 64px;
  display: flex;
  align-items: center;
  padding: 0 40px;
  gap: 24px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.logo { font-family: Georgia, serif; font-size: 28px; letter-spacing: -0.5px; }
.logo span { color: var(--teal); }
.topbar-div { width: 1px; height: 22px; background: var(--brd2); }
.topbar-label { font-family: monospace; font-size: 13px; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,0.8); }
.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
.status-dot { width: 7px; height: 7px; border-radius: 50%; animation: pulse 2s ease infinite; }
.status-txt { font-family: monospace; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); }

/* â”€â”€ PROGRESS â”€â”€ */
.prog-wrap { height: 2px; background: var(--brd); }
.prog-bar { height: 100%; background: linear-gradient(90deg, var(--teal), var(--gold)); width: 0%; transition: width .6s ease; }

/* â”€â”€ SCREENS â”€â”€ */
.screen { display: none; min-height: calc(100vh - 54px); }
.screen.active { display: flex; flex-direction: column; }

/* â”€â”€ INTAKE â”€â”€ */
.intake-wrap {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 32px;
  text-align: center;
}
.intake-eye { font-family: monospace; font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--teal); margin-bottom: 24px; }
.intake-h1 { font-family: Georgia, serif; font-size: 50px; line-height: 1.1; letter-spacing: -1.5px; margin-bottom: 16px; }
.intake-h1 em { color: var(--teal); font-style: italic; }
.intake-sub { font-size: 16px; color: var(--muted); max-width: 420px; line-height: 1.65; margin-bottom: 52px; }

.problem-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  width: 100%;
  max-width: 720px;
  margin-bottom: 32px;
}
.problem-btn {
  background: var(--surf);
  border: 1px solid var(--brd2);
  color: var(--text);
  padding: 22px 20px;
  cursor: pointer;
  text-align: left;
  transition: all .2s;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.problem-btn:hover { border-color: var(--teal); background: rgba(0,196,184,.06); }
.problem-btn.selected { border-color: var(--teal); background: rgba(0,196,184,.1); }
.problem-icon { font-size: 22px; }
.problem-title { font-size: 14px; font-weight: 600; color: var(--text); }
.problem-desc { font-size: 12px; color: var(--muted); line-height: 1.5; }
.problem-module { font-family: monospace; font-size: 8px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--teal); margin-top: 4px; }

.url-section { width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 12px; }
.field-label { font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); text-align: left; margin-bottom: 6px; display: block; }
.field-input {
  background: var(--surf);
  border: 1px solid var(--brd2);
  color: var(--text);
  font-family: inherit;
  font-size: 15px;
  padding: 13px 16px;
  outline: none;
  width: 100%;
  transition: border-color .15s;
}
.field-input:focus { border-color: var(--teal); }
.run-btn {
  background: var(--teal);
  color: #0A0C10;
  border: none;
  padding: 15px 32px;
  font-family: monospace;
  font-size: 11px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  cursor: pointer;
  font-weight: 700;
  transition: all .2s;
  width: 100%;
}
.run-btn:hover { background: #00E5D8; }
.run-btn:disabled { background: var(--muted2); color: var(--muted); cursor: default; }

/* â”€â”€ PIPELINE â”€â”€ */
.pipeline-wrap { flex: 1; overflow-y: auto; padding: 40px 48px; }
.pipe-header { margin-bottom: 32px; padding-bottom: 22px; border-bottom: 1px solid var(--brd); display: flex; justify-content: space-between; align-items: flex-end; }
.pipe-label { font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--teal); margin-bottom: 8px; }
.pipe-title { font-family: Georgia, serif; font-size: 32px; letter-spacing: -0.5px; margin-bottom: 4px; }
.pipe-url { font-family: monospace; font-size: 11px; color: var(--muted); }
.new-btn { background: transparent; border: 1px solid var(--brd2); color: var(--muted); padding: 7px 14px; font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all .15s; }
.new-btn:hover { border-color: var(--teal); color: var(--teal); }

/* stage blocks */
.stage-block { border: 1px solid var(--brd); margin-bottom: 10px; overflow: hidden; transition: all .3s; }
.stage-block.running { border-color: var(--gold); box-shadow: 0 0 20px rgba(201,168,76,.08); }
.stage-block.done { border-color: var(--brd2); }
.stage-hdr { display: flex; align-items: center; gap: 14px; padding: 13px 20px; background: var(--surf); cursor: pointer; }
.stage-num { font-family: monospace; font-size: 11px; width: 22px; flex-shrink: 0; }
.stage-block.done .stage-num { color: var(--teal); }
.stage-block.running .stage-num { color: var(--gold); }
.stage-block.pending .stage-num { color: var(--muted2); }
.stage-icon { width: 19px; height: 19px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; }
.stage-block.done .stage-icon { background: rgba(0,196,184,.12); color: var(--teal); }
.stage-block.running .stage-icon { background: rgba(201,168,76,.12); color: var(--gold); animation: spin 1.2s linear infinite; }
.stage-block.pending .stage-icon { background: var(--brd); color: var(--muted2); }
.stage-name { flex: 1; font-size: 13px; font-weight: 600; }
.stage-block.pending .stage-name { color: var(--muted2); }
.stage-badge { font-family: monospace; font-size: 8px; letter-spacing: 1.5px; text-transform: uppercase; padding: 3px 8px; border-radius: 2px; }
.badge-done { background: rgba(0,196,184,.1); color: var(--teal); }
.badge-running { background: rgba(201,168,76,.1); color: var(--gold); }
.badge-pending { background: var(--brd); color: var(--muted2); }
.stage-body { display: none; padding: 18px 20px 22px 55px; background: var(--bg); border-top: 1px solid var(--brd); }
.stage-body.open { display: block; }
.stage-out { font-family: monospace; font-size: 12px; color: #A0AABB; line-height: 1.85; white-space: pre-wrap; word-break: break-word; }
.stage-thinking { display: flex; align-items: center; gap: 8px; color: var(--gold); font-family: monospace; font-size: 11px; }
.thinking-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--gold); animation: pulse 1s ease infinite; }

/* â”€â”€ GATE â”€â”€ */
.gate-screen { flex: 1; overflow-y: auto; padding: 40px 48px; }
.gate-banner {
  background: var(--orange);
  padding: 20px 28px;
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 36px;
}
.gate-banner-label { font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,.7); }
.gate-banner-title { font-family: Georgia, serif; font-size: 22px; color: white; }
.gate-banner-sub { font-size: 13px; color: rgba(255,255,255,.75); margin-top: 4px; }
.gate-banner-right { margin-left: auto; font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,.5); }

.modules-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 36px; }
.module-card {
  background: var(--surf);
  border: 1px solid var(--brd2);
  padding: 20px 22px;
  cursor: pointer;
  transition: all .2s;
  position: relative;
}
.module-card:hover { border-color: var(--teal); }
.module-card.selected { border-color: var(--teal); background: rgba(0,196,184,.06); }
.module-card.selected::after { content: "âœ“"; position: absolute; top: 16px; right: 16px; color: var(--teal); font-size: 16px; font-weight: 700; }
.module-rec { font-family: monospace; font-size: 8px; letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 8px; }
.rec-yes { color: var(--green); }
.rec-maybe { color: var(--gold); }
.rec-defer { color: var(--muted); }
.module-name { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
.module-scope { font-size: 12px; color: var(--muted); line-height: 1.5; margin-bottom: 10px; }
.module-meta { display: flex; gap: 16px; }
.module-meta-item { font-family: monospace; font-size: 10px; color: var(--muted2); }
.module-meta-item span { color: var(--text); }

.gate-actions { display: flex; gap: 12px; margin-top: 8px; }
.proposal-btn {
  background: var(--teal);
  color: #0A0C10;
  border: none;
  padding: 15px 32px;
  font-family: monospace;
  font-size: 11px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  cursor: pointer;
  font-weight: 700;
  flex: 1;
  transition: all .2s;
}
.proposal-btn:hover { background: #00E5D8; }
.proposal-btn:disabled { background: var(--muted2); color: var(--muted); cursor: default; }
.back-btn { background: transparent; border: 1px solid var(--brd2); color: var(--muted); padding: 15px 24px; font-family: monospace; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all .15s; }
.back-btn:hover { border-color: var(--muted); color: var(--text); }

/* â”€â”€ PROPOSAL â”€â”€ */
.proposal-wrap { flex: 1; overflow-y: auto; padding: 40px 48px; }
.proposal-doc {
  max-width: 820px;
  margin: 0 auto;
  background: white;
  color: #111318;
  padding: 60px 64px;
}
.prop-letterhead { border-bottom: 3px solid #111318; padding-bottom: 24px; margin-bottom: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
.prop-logo { font-family: Georgia, serif; font-size: 28px; letter-spacing: -0.5px; color: #111318; }
.prop-logo span { color: #007A72; }
.prop-meta { text-align: right; font-family: monospace; font-size: 10px; color: #A0AABB; line-height: 1.6; }
.prop-to { margin-bottom: 32px; }
.prop-to-label { font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: #A0AABB; margin-bottom: 8px; }
.prop-to-name { font-family: Georgia, serif; font-size: 28px; color: #111318; margin-bottom: 4px; }
.prop-to-url { font-family: monospace; font-size: 12px; color: #A0AABB; }
.prop-section-title { font-family: Georgia, serif; font-size: 20px; color: #111318; margin: 36px 0 16px; border-bottom: 1px solid #E5E7EB; padding-bottom: 10px; }
.prop-summary { font-size: 14px; color: #374151; line-height: 1.75; margin-bottom: 24px; }
.prop-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 8px; }
.prop-table th { font-family: monospace; font-size: 8px; letter-spacing: 1.5px; text-transform: uppercase; color: #A0AABB; text-align: left; padding: 8px 12px; border-bottom: 2px solid #E5E7EB; font-weight: 400; }
.prop-table td { padding: 12px 12px; border-bottom: 1px solid #F3F4F6; color: #374151; vertical-align: top; }
.prop-table tr:last-child td { border-bottom: none; }
.prop-table .module-col { font-weight: 600; color: #111318; }
.prop-total { background: #111318; color: white; padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
.prop-total-label { font-family: monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,.5); }
.prop-total-amount { font-family: Georgia, serif; font-size: 28px; color: white; }
.prop-total-amount span { color: #6ECDC7; }
.prop-roadmap { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin: 16px 0 8px; }
.roadmap-month { background: #F9FAFB; border: 1px solid #E5E7EB; padding: 16px 18px; }
.roadmap-month-label { font-family: monospace; font-size: 8px; letter-spacing: 2px; text-transform: uppercase; color: #A0AABB; margin-bottom: 10px; }
.roadmap-item { font-size: 12px; color: #374151; padding: 3px 0; border-bottom: 1px solid #F3F4F6; }
.prop-sign { margin-top: 40px; padding-top: 32px; border-top: 1px solid #E5E7EB; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
.sign-block label { font-family: monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: #A0AABB; display: block; margin-bottom: 8px; }
.sign-line { border-bottom: 1px solid #111318; height: 40px; margin-bottom: 6px; }
.sign-name-label { font-family: monospace; font-size: 9px; color: #B0BBCC; }
.prop-actions { display: flex; gap: 12px; margin-top: 24px; }
.print-btn { background: #111318; color: white; border: none; padding: 13px 28px; font-family: monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all .2s; }
.print-btn:hover { background: #007A72; }
.deploy-btn { background: #007A72; color: white; border: none; padding: 13px 28px; font-family: monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; flex: 1; transition: all .2s; font-weight: 700; }
.deploy-btn:hover { background: #00A99D; }

/* â”€â”€ DEPLOY â”€â”€ */
.deploy-wrap { flex: 1; overflow-y: auto; padding: 40px 48px; }
.deploy-header { margin-bottom: 36px; padding-bottom: 22px; border-bottom: 1px solid var(--brd); }
.deploy-agents { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 36px; }
.agent-card { background: var(--surf); border: 1px solid var(--brd); padding: 18px 20px; transition: all .3s; }
.agent-card.firing { border-color: var(--gold); box-shadow: 0 0 14px rgba(201,168,76,.1); }
.agent-card.live { border-color: var(--green); }
.agent-icon { font-size: 22px; margin-bottom: 10px; }
.agent-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
.agent-status { font-family: monospace; font-size: 9px; letter-spacing: 1.5px; text-transform: uppercase; }
.agent-card.firing .agent-status { color: var(--gold); }
.agent-card.live .agent-status { color: var(--green); }
.agent-card.pending .agent-status { color: var(--muted2); }
.agent-task { font-size: 11px; color: var(--muted); margin-top: 8px; line-height: 1.5; }

.live-banner { background: var(--green); padding: 28px 36px; margin-top: 24px; }
.live-banner-label { font-family: monospace; font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: rgba(0,0,0,.5); margin-bottom: 8px; }
.live-banner-title { font-family: Georgia, serif; font-size: 32px; color: white; letter-spacing: -0.5px; }
.live-banner-sub { font-size: 14px; color: rgba(255,255,255,.8); margin-top: 6px; }

/* â”€â”€ UTILS â”€â”€ */
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
@keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-thumb { background: #2A2F3A; border-radius: 2px; }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo">Ground<span>Work</span></div>
  <div class="topbar-div"></div>
  <div class="topbar-label">Geek Certified Â· Research & Deployment Intelligence</div>
  <div class="topbar-right">
    <div class="status-dot" id="statusDot" style="background:var(--green);box-shadow:0 0 8px var(--green)"></div>
    <div class="status-txt" id="statusTxt">System Ready</div>
    <button class="new-btn" id="newBtn" style="display:none" onclick="resetAll()">+ New Client</button>
  </div>
</div>

<!-- PROGRESS -->
<div class="prog-wrap"><div class="prog-bar" id="progBar"></div></div>

<!-- â•â• SCREEN 1: INTAKE â•â• -->
<div class="screen active" id="screenIntake">
  <div class="intake-wrap">
    <div class="intake-eye">GroundWork Intelligence Pipeline</div>
    <div class="intake-h1">What's your<br><em>biggest problem?</em></div>
    <div class="intake-sub">Tell us what's wrong. We'll figure out exactly what needs fixing â€” and prove it with data.</div>

    <div class="problem-grid">
      <button class="problem-btn" onclick="selectProblem(this,'traffic','Full SEO & Content Pipeline')">
        <div class="problem-icon">ğŸ“‰</div>
        <div class="problem-title">"Nobody can find us online"</div>
        <div class="problem-desc">Low traffic, not showing up on Google, invisible to new customers</div>
        <div class="problem-module">â†’ SEO + Content Module</div>
      </button>
      <button class="problem-btn" onclick="selectProblem(this,'calls','GBP + Local SEO Pipeline')">
        <div class="problem-icon">ğŸ“</div>
        <div class="problem-title">"We get traffic but no calls"</div>
        <div class="problem-desc">People find us but don't convert â€” no trust, no reviews, no action</div>
        <div class="problem-module">â†’ GBP + Reputation Module</div>
      </button>
      <button class="problem-btn" onclick="selectProblem(this,'social','Social Media Pipeline')">
        <div class="problem-icon">ğŸ“±</div>
        <div class="problem-title">"We have no social presence"</div>
        <div class="problem-desc">Competitors are active on Instagram and Facebook â€” we're invisible</div>
        <div class="problem-module">â†’ Social Media Module</div>
      </button>
      <button class="problem-btn" onclick="selectProblem(this,'reviews','Reputation Pipeline')">
        <div class="problem-icon">â­</div>
        <div class="problem-title">"Our reviews are bad â€” or zero"</div>
        <div class="problem-desc">No reviews or poor ratings are killing our credibility before they even call</div>
        <div class="problem-module">â†’ Review & Reputation Module</div>
      </button>
      <button class="problem-btn" onclick="selectProblem(this,'competitors','Competitive Intelligence Pipeline')">
        <div class="problem-icon">ğŸ¯</div>
        <div class="problem-title">"Competitors are beating us"</div>
        <div class="problem-desc">They rank higher, get more calls, look more professional â€” why?</div>
        <div class="problem-module">â†’ Competitive Analysis Module</div>
      </button>
      <button class="problem-btn" onclick="selectProblem(this,'full','Full 8-Stage Pipeline')">
        <div class="problem-icon">ğŸ”</div>
        <div class="problem-title">"Just audit everything"</div>
        <div class="problem-desc">We don't know what's wrong â€” show us the complete picture</div>
        <div class="problem-module">â†’ Full GroundWork Pipeline</div>
      </button>
    </div>

    <div class="url-section">
      <div>
        <label class="field-label">Your Website URL *</label>
        <input class="field-input" id="urlInput" type="text" placeholder="https://yourbusiness.com" />
      </div>
      <div>
        <label class="field-label">Company Name (optional â€” we'll detect it)</label>
        <input class="field-input" id="nameInput" type="text" placeholder="Auto-detected from your site" />
      </div>
      <button class="run-btn" id="runBtn" disabled onclick="startPipeline()">
        Select a problem above to begin â†’
      </button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 2: PIPELINE â•â• -->
<div class="screen" id="screenPipeline">
  <div class="pipeline-wrap">
    <div class="pipe-header">
      <div>
        <div class="pipe-label" id="pipeModule">Pipeline Running</div>
        <div class="pipe-title" id="pipeTitle">Analysing...</div>
        <div class="pipe-url" id="pipeUrl"></div>
      </div>
      <button class="new-btn" onclick="resetAll()">+ New Client</button>
    </div>
    <div id="stageContainer"></div>
  </div>
</div>

<!-- â•â• SCREEN 3: GATE â•â• -->
<div class="screen" id="screenGate">
  <div class="gate-screen">
    <div class="gate-banner">
      <div>
        <div class="gate-banner-label">âš¡ Approval Gate</div>
        <div class="gate-banner-title">Research Complete. Select Your Modules.</div>
        <div class="gate-banner-sub">Choose what to fix. We'll build the proposal instantly.</div>
      </div>
      <div class="gate-banner-right" id="gateBannerMeta"></div>
    </div>

    <div class="modules-grid" id="modulesGrid"></div>

    <div style="background:var(--surf);border:1px solid var(--brd2);padding:20px 24px;margin-bottom:24px">
      <div style="font-family:monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--teal);margin-bottom:10px">Gap Analysis Summary</div>
      <div id="gapSummary" style="font-family:monospace;font-size:12px;color:#A0AABB;line-height:1.85;white-space:pre-wrap"></div>
    </div>

    <div class="gate-actions">
      <button class="back-btn" onclick="showScreen('screenPipeline')">â† View Research</button>
      <button class="proposal-btn" id="proposalBtn" onclick="buildProposal()">Generate Proposal â†’</button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 4: PROPOSAL â•â• -->
<div class="screen" id="screenProposal">
  <div class="proposal-wrap">
    <div class="proposal-doc" id="proposalDoc">
      <!-- generated dynamically -->
    </div>
    <div class="prop-actions" style="max-width:820px;margin:16px auto 0">
      <button class="back-btn" onclick="showScreen('screenGate')">â† Back to Modules</button>
      <button class="print-btn" onclick="window.print()">Print / Save PDF</button>
      <button class="deploy-btn" onclick="startDeploy()">Client Approved â€” Deploy Agents â†’</button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 5: DEPLOY â•â• -->
<div class="screen" id="screenDeploy">
  <div class="deploy-wrap">
    <div class="deploy-header">
      <div class="pipe-label">Agents Deploying</div>
      <div class="pipe-title" id="deployTitle">Agents firing in parallel</div>
      <div class="pipe-url" id="deployUrl"></div>
    </div>
    <!-- DEMO FIRE BUTTON -->
    <div style="margin-bottom:28px">
      <div style="background:var(--surf);border:1px solid var(--gold);padding:28px 32px">
        <div style="font-family:monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--gold);margin-bottom:12px">Blog Agent Live Demo</div>
        <div style="font-size:18px;font-weight:700;color:var(--text);margin-bottom:8px" id="demoClientName">Ready to fire</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:24px">Claude writes a complete SEO article and delivers it to the team inbox in real time. Watch it happen.</div>
        <button id="fireBlogBtn" onclick="fireBlogAgent()" style="background:var(--gold);color:#0A0C10;border:none;padding:18px 40px;font-family:monospace;font-size:12px;letter-spacing:2.5px;text-transform:uppercase;font-weight:700;cursor:pointer;width:100%">
          Fire Blog Agent Now
        </button>
        <div id="blogFiring" style="display:none;margin-top:20px;text-align:center;padding:16px">
          <div style="font-family:monospace;font-size:11px;color:var(--gold);letter-spacing:1px">Claude is writing the article...</div>
          <div style="font-size:12px;color:var(--muted);margin-top:6px">Takes about 20 seconds</div>
        </div>
        <div id="blogResult" style="display:none;margin-top:20px;padding:20px;background:var(--bg);border:1px solid var(--green)">
          <div style="font-family:monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--green);margin-bottom:10px">Article Written - Email Sent to Team</div>
          <div id="blogResultTitle" style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:6px"></div>
          <div id="blogResultMeta" style="font-family:monospace;font-size:11px;color:var(--muted)"></div>
        </div>
      </div>
    </div>
    <div class="deploy-agents" id="deployAgents"></div>
    <div class="live-banner" id="liveBanner" style="display:none">
      <div class="live-banner-label">âœ“ GroundWork Complete</div>
      <div class="live-banner-title" id="liveTitle">Client is live.</div>
      <div class="live-banner-sub">Content publishing. GBP active. Reviews growing. Monthly reporting begins.</div>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  problem: null,
  module: null,
  url: '',
  name: '',
  stageOutputs: {},
  selectedModules: [],
};

const PROBLEMS = {
  traffic:     { label: 'SEO & Content Pipeline',          color: '#06B6D4' },
  calls:       { label: 'GBP & Local SEO Pipeline',        color: '#22C55E' },
  social:      { label: 'Social Media Pipeline',           color: '#A855F7' },
  reviews:     { label: 'Reputation Pipeline',             color: '#F97316' },
  competitors: { label: 'Competitive Intelligence',        color: '#EF4444' },
  full:        { label: 'Full 8-Stage Pipeline',           color: '#00C4B8' },
};

const STAGES = [
  { num:1, name:'Master Audit',         desc:'Website Â· Digital presence Â· SEO signals Â· Industry' },
  { num:2, name:'Competitive Analysis', desc:'Rivals Â· Dossiers Â· Comparison table' },
  { num:3, name:'Keyword Research',     desc:'Short tail Â· Long tail Â· LSI Â· Local Â· GEO/AEO' },
  { num:4, name:'Gap Analysis',         desc:'Every gap ranked by revenue impact' },
  { num:5, name:'Readiness Assessment', desc:'What actually exists right now' },
  { num:6, name:'Prerequisites',        desc:'Blockers only Â· Client-facing Â· By urgency' },
  { num:7, name:'Decision Point',       desc:'Full scope Â· Investment ranges Â· Module selection' },
];

const MODULES = [
  { id:'gbp',       name:'Google Business Profile',    scope:'Verify, optimise & post to all locations',    timeline:'Immediate',  setup:'$300',  monthly:'$200', rec:'yes',   tasks:['Verify all locations','Optimise categories & attributes','2Ã— weekly posts','Q&A management','Photo uploads'] },
  { id:'reviews',   name:'Review Generation System',   scope:'Automated requests, QR codes, responses',     timeline:'Week 1',     setup:'$300',  monthly:'$200', rec:'yes',   tasks:['Email review requests','QR codes per location','Response templates','Monthly reporting'] },
  { id:'schema',    name:'Schema Markup',               scope:'Full site structured data for AI search',     timeline:'Month 1',    setup:'$400',  monthly:'$100', rec:'yes',   tasks:['LocalBusiness schema','Product schema','FAQ schema','BreadcrumbList'] },
  { id:'blog',      name:'Blog + SEO Content',          scope:'10 keyword-targeted articles per month',      timeline:'Month 1',    setup:'$200',  monthly:'$1200', rec:'yes',  tasks:['Blog platform setup','10 articles month 1','LSI & GEO/AEO optimised','Publish to WordPress'] },
  { id:'instagram', name:'Instagram Launch',            scope:'Account setup, content calendar, posting',    timeline:'Month 1',    setup:'$600',  monthly:'$800', rec:'maybe', tasks:['Business account setup','30-day calendar','Caption & hashtag strategy','Reels repurposing'] },
  { id:'facebook',  name:'Facebook Business Page',      scope:'Page setup, posting, Marketplace presence',  timeline:'Month 1',    setup:'$400',  monthly:'$600', rec:'maybe', tasks:['Business Page optimisation','Content calendar','Marketplace listings'] },
  { id:'email',     name:'Email Campaigns',             scope:'Campaigns to existing list â€” overstock deals', timeline:'Month 1',   setup:'$300',  monthly:'$300', rec:'yes',   tasks:['Campaign strategy','Overstock deal templates','Segmented sends','Monthly reporting'] },
  { id:'citations', name:'Local Citations & NAP',       scope:'Consistent listings across all directories',  timeline:'Month 1',    setup:'$300',  monthly:'$150', rec:'yes',   tasks:['Bing Places','Apple Business Connect','Yelp','Houzz','Industry directories'] },
  { id:'youtube',   name:'YouTube Channel',             scope:'Channel setup, video scripts, publishing',    timeline:'Month 2',    setup:'$500',  monthly:'$400', rec:'maybe', tasks:['Channel setup','10 video scripts','Thumbnail strategy','Shorts repurposing'] },
  { id:'tiktok',    name:'TikTok Account',              scope:'Account, content strategy, posting',          timeline:'Month 2',    setup:'$400',  monthly:'$600', rec:'defer', tasks:['Business account','Content strategy','30-day calendar'] },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAVIGATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function resetAll() {
  state = { problem:null, module:null, url:'', name:'', stageOutputs:{}, selectedModules:[] };
  document.getElementById('urlInput').value = '';
  document.getElementById('nameInput').value = '';
  document.getElementById('runBtn').disabled = true;
  document.getElementById('runBtn').textContent = 'Select a problem above to begin â†’';
  document.querySelectorAll('.problem-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('progBar').style.width = '0%';
  document.getElementById('newBtn').style.display = 'none';
  document.getElementById('statusDot').style.background = 'var(--green)';
  document.getElementById('statusDot').style.boxShadow = '0 0 8px var(--green)';
  document.getElementById('statusTxt').textContent = 'System Ready';
  showScreen('screenIntake');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INTAKE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectProblem(btn, key, moduleLabel) {
  document.querySelectorAll('.problem-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.problem = key;
  state.module = moduleLabel;
  document.getElementById('runBtn').disabled = false;
  document.getElementById('runBtn').textContent = 'Run GroundWork â†’ ' + moduleLabel;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PIPELINE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startPipeline() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url) { document.getElementById('urlInput').focus(); return; }

  state.url  = url;
  state.name = document.getElementById('nameInput').value.trim() || url.replace(/https?:\/\//,'').split('/')[0];

  // UI setup
  document.getElementById('pipeModule').textContent = PROBLEMS[state.problem]?.label || 'Pipeline Running';
  document.getElementById('pipeTitle').textContent  = state.name;
  document.getElementById('pipeUrl').textContent    = state.url;
  document.getElementById('newBtn').style.display   = 'block';

  setStatus('running', 'Running');
  buildStageBlocks();
  showScreen('screenPipeline');

  const ctx = { url: state.url, name: state.name };

  for (let i = 0; i < STAGES.length; i++) {
    const stage = STAGES[i];
    setStageState(stage.num, 'running');
    setProgress(Math.round((i / STAGES.length) * 90));
    document.getElementById(`body-${stage.num}`).classList.add('open');

    const output = await callStage(stage.num, ctx);
    ctx['s' + stage.num] = output;
    state.stageOutputs[stage.num] = output;
    document.getElementById(`out-${stage.num}`).textContent = output;
    setStageState(stage.num, 'done');
    await sleep(400);
  }

  setProgress(100);
  setStatus('ready', 'Research Complete');
  await sleep(700);
  buildGate();
  showScreen('screenGate');
}

function buildStageBlocks() {
  const c = document.getElementById('stageContainer');
  c.innerHTML = '';
  STAGES.forEach(s => {
    c.innerHTML += `
      <div class="stage-block pending" id="block-${s.num}">
        <div class="stage-hdr" onclick="toggleBody(${s.num})">
          <div class="stage-num">0${s.num}</div>
          <div class="stage-icon" id="icon-${s.num}">â—‹</div>
          <div style="flex:1">
            <div class="stage-name" id="sname-${s.num}">${s.name}</div>
            <div style="font-family:monospace;font-size:10px;color:var(--muted2);margin-top:2px">${s.desc}</div>
          </div>
          <div class="stage-badge badge-pending" id="badge-${s.num}">Pending</div>
        </div>
        <div class="stage-body" id="body-${s.num}">
          <div class="stage-thinking" id="think-${s.num}"><div class="thinking-dot"></div>Analysing...</div>
          <div class="stage-out" id="out-${s.num}"></div>
        </div>
      </div>`;
  });
}

function toggleBody(num) {
  document.getElementById('body-' + num).classList.toggle('open');
}

function setStageState(num, status) {
  const block = document.getElementById('block-' + num);
  const icon  = document.getElementById('icon-' + num);
  const badge = document.getElementById('badge-' + num);
  const think = document.getElementById('think-' + num);

  block.className = 'stage-block ' + status;
  if (status === 'running') {
    icon.textContent = 'â†»'; icon.style.animation = 'spin 1.2s linear infinite';
    badge.textContent = 'Running'; badge.className = 'stage-badge badge-running';
  } else if (status === 'done') {
    icon.textContent = 'âœ“'; icon.style.animation = 'none';
    badge.textContent = 'Complete'; badge.className = 'stage-badge badge-done';
    if (think) think.style.display = 'none';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// API CALL â€” through Netlify proxy
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callStage(num, ctx) {
  const prompts = {
    1: { sys: 'You are a senior business intelligence analyst. Stage 1 â€” Master Audit. Be specific and structured. Use ALL CAPS section headers. 500-600 words.',
         usr: `Master Audit for: ${ctx.url}\n\nCOMPANY PROFILE\nWhat they do, who they serve, where, how positioned.\n\nDIGITAL PRESENCE AUDIT\nWebsite platform, social channels, GBP status, review presence.\n\nSEO SIGNALS\nMeta tags, schema detected, blog active, indexed pages estimate, mobile readiness.\n\nINDUSTRY CONTEXT\nMarket size, trends, AI impact on this industry.\n\nKEY FINDINGS\n5 numbered observations that drive the strategy.` },
    2: { sys: 'Senior competitive intelligence analyst. Stage 2. Identify real competitors. Be specific. 400-500 words.',
         usr: `Competitive Analysis for: ${ctx.url}\nContext: ${ctx.s1?.slice(0,400)}\n\nCOMPETITORS IDENTIFIED\n3-4 direct competitors. Name, website, strongest asset vs client, biggest weakness, estimated social/review count.\n\nCOMPARISON TABLE\nChannel | Client | Comp1 | Comp2 | Comp3\nRows: Reviews | Instagram | Facebook | Blog | Schema | GBP Posts\n\nTOP COMPETITIVE OPPORTUNITY\nThe single biggest gap no competitor owns.` },
    3: { sys: 'Senior SEO keyword strategist. Stage 3. Real keyword phrases. 500-600 words.',
         usr: `Keyword Research for: ${ctx.url}\nBusiness: ${ctx.s1?.slice(0,350)}\n\nSHORT TAIL â€” 6 keywords | intent\nMID TAIL â€” 10 keywords | intent\nLONG TAIL QUICK WINS â€” 15 keywords | why it converts\nLSI SEMANTIC â€” 12 related terms\nLOCAL KEYWORDS â€” 8 service+city combos\nGEO/AEO QUESTIONS â€” 10 questions for AI search\nPRIORITY TOP 10 â€” star 3 fastest wins` },
    4: { sys: 'Senior digital marketing strategist. Stage 4 â€” Gap Analysis. Plain English revenue impact. What is each gap costing them right now. 500-600 words.',
         usr: `Gap Analysis for: ${ctx.url}\nResearch: ${ctx.s1?.slice(0,250)} | Competitors: ${ctx.s2?.slice(0,200)}\n\nTop 10 digital gaps:\nCHANNEL | THE GAP | REVENUE IMPACT (one plain sentence) | PRIORITY ğŸ”´/ğŸŸ¡/ğŸŸ¢\n\nSort by revenue impact highest first.\n\nQUICK WIN SUMMARY â€” 3 gaps closable in under 2 weeks.` },
    5: { sys: 'Stage 5 â€” Readiness Assessment. What actually exists from outside the business. 300-400 words.',
         usr: `Readiness for: ${ctx.url}\n\nâœ… Confirmed / âš ï¸ Partial / âŒ Missing\n\nWEBSITE: CMS, blog, booking system\nGBP: claimed, verified, posts active, photos\nSOCIAL: Instagram, Facebook, LinkedIn\nASSETS: photography, logo, brand guidelines\nREPUTATION: review count, rating, platforms\n\nCRITICAL FLAGS â€” every âŒ blocking execution.` },
    6: { sys: 'Stage 6 â€” Client-facing Prerequisites. Only MISSING and BLOCKING. No jargon. Max 10 items. 250-350 words.',
         usr: `Prerequisites for: ${ctx.url}\nReadiness: ${ctx.s5?.slice(0,350)}\n\nğŸ”´ BLOCKER / ğŸŸ¡ REQUIRED / ğŸŸ¢ HELPFUL\nWHAT NEEDED | WHO | WHY IT MATTERS\n\nMax 10. Blockers first. Plain English.\n\nWHAT HAPPENS NEXT â€” agents fire once these are resolved.` },
    7: { sys: 'Stage 7 â€” Decision Point. Full scope with investment ranges for client sign-off. 400-500 words.',
         usr: `Decision Point for: ${ctx.url}\nGaps: ${ctx.s4?.slice(0,350)}\n\nMODULE TABLE\nMODULE | SCOPE | TIMELINE | MONTHLY INVESTMENT | RECOMMENDATION (YES/DECISION/DEFER)\n\nModules: GBP, Reviews, Schema, Instagram, Blog, Facebook, Email, Citations, YouTube\n\nMINIMUM RECOMMENDED â€” 3-4 modules for results in 90 days.\n\n90-DAY ROADMAP â€” Month 1 | Month 2 | Month 3` },
  };

  const p = prompts[num];
  if (!p) return 'Stage ' + num + ' complete.';

  try {
    const res = await fetch('/.netlify/functions/proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: p.sys,
        messages: [{ role: 'user', content: p.usr }]
      })
    });
    const data = await res.json();
    return data.content?.[0]?.text || 'Analysis complete.';
  } catch(e) {
    return `Stage ${num} analysis complete for ${ctx.url}.\n\n[Connect API to see live intelligence]`;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildGate() {
  document.getElementById('gateBannerMeta').innerHTML =
    `${state.name}<br><span style="color:rgba(255,255,255,.4);font-size:10px">${state.url}</span>`;

  // Gap summary
  document.getElementById('gapSummary').textContent =
    state.stageOutputs[4]?.slice(0, 800) || 'Gap analysis complete.';

  // Modules grid
  const grid = document.getElementById('modulesGrid');
  grid.innerHTML = '';
  MODULES.forEach(m => {
    const rec = m.rec === 'yes' ? ['rec-yes','âœ… Recommended â€” Do Now'] :
                m.rec === 'maybe' ? ['rec-maybe','ğŸ¤” Client Decision'] :
                ['rec-defer','â³ Defer â€” Month 2+'];
    grid.innerHTML += `
      <div class="module-card ${m.rec === 'yes' ? 'selected' : ''}" id="mod-${m.id}" onclick="toggleModule('${m.id}')">
        <div class="module-rec ${rec[0]}">${rec[1]}</div>
        <div class="module-name">${m.name}</div>
        <div class="module-scope">${m.scope}</div>
        <div class="module-meta">
          <div class="module-meta-item">Setup <span>${m.setup}</span></div>
          <div class="module-meta-item">Monthly <span>${m.monthly}</span></div>
          <div class="module-meta-item">Timeline <span>${m.timeline}</span></div>
        </div>
      </div>`;
    if (m.rec === 'yes') state.selectedModules.push(m.id);
  });
  // deduplicate
  state.selectedModules = [...new Set(state.selectedModules)];
}

function toggleModule(id) {
  const card = document.getElementById('mod-' + id);
  const idx  = state.selectedModules.indexOf(id);
  if (idx >= 0) {
    state.selectedModules.splice(idx, 1);
    card.classList.remove('selected');
  } else {
    state.selectedModules.push(id);
    card.classList.add('selected');
  }
  document.getElementById('proposalBtn').disabled = state.selectedModules.length === 0;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PROPOSAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildProposal() {
  const selected = MODULES.filter(m => state.selectedModules.includes(m.id));
  const setupTotal = selected.reduce((sum, m) => sum + parseInt(m.setup.replace(/\D/g,'')), 0);
  const monthlyTotal = selected.reduce((sum, m) => sum + parseInt(m.monthly.replace(/\D/g,'')), 0);
  const today = new Date().toLocaleDateString('en-CA', { year:'numeric', month:'long', day:'numeric' });

  const tableRows = selected.map(m => `
    <tr>
      <td class="module-col">${m.name}</td>
      <td>${m.scope}</td>
      <td>${m.timeline}</td>
      <td>${m.setup}</td>
      <td>${m.monthly}/mo</td>
    </tr>`).join('');

  const month1 = selected.filter(m => m.timeline === 'Immediate' || m.timeline === 'Week 1' || m.timeline === 'Month 1');
  const month2 = selected.filter(m => m.timeline === 'Month 2');
  const month3 = selected.filter(m => m.timeline === 'Month 3' || m.timeline === 'Month 2-3');

  const mkList = (arr) => arr.length
    ? arr.map(m => `<div class="roadmap-item">â†’ ${m.name}</div>`).join('')
    : `<div class="roadmap-item" style="color:#B0BBCC">Nothing scheduled</div>`;

  document.getElementById('proposalDoc').innerHTML = `
    <div class="prop-letterhead">
      <div>
        <div class="prop-logo">Ground<span>Work</span></div>
        <div style="font-family:monospace;font-size:10px;color:#A0AABB;margin-top:4px;letter-spacing:1px">Geek Certified Â· Research & Deployment Intelligence</div>
      </div>
      <div class="prop-meta">
        Prepared: ${today}<br>
        Reference: GW-${Date.now().toString(36).toUpperCase()}<br>
        Valid: 30 days
      </div>
    </div>

    <div class="prop-to">
      <div class="prop-to-label">Prepared for</div>
      <div class="prop-to-name">${state.name}</div>
      <div class="prop-to-url">${state.url}</div>
    </div>

    <div class="prop-section-title">Executive Summary</div>
    <div class="prop-summary">
      Based on our GroundWork research pipeline, we have identified the key digital gaps affecting
      <strong>${state.name}</strong>. The following modules have been selected based on your specific
      situation, your competitive landscape, and what will produce measurable results fastest.
      This proposal covers setup costs and ongoing monthly management for all selected modules.
    </div>

    <div class="prop-section-title">Scope of Work</div>
    <table class="prop-table">
      <thead>
        <tr>
          <th>Module</th>
          <th>Scope</th>
          <th>Timeline</th>
          <th>Setup</th>
          <th>Monthly</th>
        </tr>
      </thead>
      <tbody>${tableRows}</tbody>
    </table>
    <div class="prop-total">
      <div>
        <div class="prop-total-label">One-Time Setup</div>
        <div style="font-size:14px;color:rgba(255,255,255,.6);margin-top:2px">$${setupTotal.toLocaleString()} total</div>
      </div>
      <div style="text-align:right">
        <div class="prop-total-label">Monthly Retainer</div>
        <div class="prop-total-amount">$${monthlyTotal.toLocaleString()}<span>/mo</span></div>
      </div>
    </div>

    <div class="prop-section-title">90-Day Roadmap</div>
    <div class="prop-roadmap">
      <div class="roadmap-month">
        <div class="roadmap-month-label">Month 1</div>
        ${mkList(month1)}
      </div>
      <div class="roadmap-month">
        <div class="roadmap-month-label">Month 2</div>
        ${mkList(month2)}
      </div>
      <div class="roadmap-month">
        <div class="roadmap-month-label">Month 3</div>
        ${mkList(month3.length ? month3 : [{name:'Optimise & Report'}])}
      </div>
    </div>

    <div class="prop-section-title">What Happens After You Sign</div>
    <div class="prop-summary">
      Once this proposal is approved, all selected agents deploy simultaneously. Within 24 hours:
      GBP posts are live, review requests are firing, schema is coded and ready for implementation,
      and your content calendar is built. You will receive a kickoff report within 48 hours confirming
      everything is running. Monthly reporting begins at the end of Month 1.
    </div>

    <div class="prop-sign">
      <div class="sign-block">
        <label>Client Approval</label>
        <div class="sign-line"></div>
        <div class="sign-name-label">Signature Â· Date</div>
      </div>
      <div class="sign-block">
        <label>Geek Certified</label>
        <div class="sign-line"></div>
        <div class="sign-name-label">Scott Wilson Â· ${today}</div>
      </div>
    </div>`;

  showScreen('screenProposal');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DEPLOY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const N8N_BLOG_WEBHOOK = 'https://camrae.app.n8n.cloud/webhook/groundwork-blog-agent';

async function startDeploy() {
  const selected = MODULES.filter(m => state.selectedModules.includes(m.id));

  const agentMap = {
    gbp:       { icon:'ğŸ“', name:'GBP Agent',        task:'Posting to Google Business Profile Ã— all locations' },
    reviews:   { icon:'â­', name:'Review Agent',      task:'Sending review requests Â· Generating QR codes' },
    schema:    { icon:'ğŸ”§', name:'Schema Agent',      task:'Generating structured data Â· Passing to developer' },
    blog:      { icon:'âœï¸', name:'Blog Agent',        task:'Writing SEO article Â· Saving to Google Docs' },
    instagram: { icon:'ğŸ“¸', name:'Instagram Agent',   task:'Creating captions Â· Scheduling posts via Meta API' },
    facebook:  { icon:'ğŸ“˜', name:'Facebook Agent',    task:'Business Page updates Â· Content calendar' },
    email:     { icon:'ğŸ“§', name:'Email Agent',       task:'Building campaigns Â· Sending to segmented list' },
    citations: { icon:'ğŸ—ºï¸', name:'Citations Agent',   task:'Submitting NAP to Bing, Apple, Yelp, Houzz' },
    youtube:   { icon:'ğŸ¬', name:'YouTube Agent',     task:'Scripting videos Â· Titles Â· Descriptions Â· Tags' },
    tiktok:    { icon:'ğŸ“±', name:'TikTok Agent',      task:'Content strategy Â· Scheduling short-form video' },
  };

  document.getElementById('deployTitle').textContent = state.name + ' â€” Agents Firing';
  document.getElementById('deployUrl').textContent   = state.url;

  const grid = document.getElementById('deployAgents');
  grid.innerHTML = '';
  selected.forEach(m => {
    const ag = agentMap[m.id] || { icon:'âš¡', name:m.name+' Agent', task:m.scope };
    grid.innerHTML += `
      <div class="agent-card pending" id="agent-${m.id}">
        <div class="agent-icon">${ag.icon}</div>
        <div class="agent-name">${ag.name}</div>
        <div class="agent-status">Pending</div>
        <div class="agent-task" id="task-${m.id}">${ag.task}</div>
      </div>`;
  });

  showScreen('screenDeploy');

  // Fire agents one by one
  let i = 0;
  for (const m of selected) {
    const card = document.getElementById('agent-' + m.id);
    card.className = 'agent-card firing';
    card.querySelector('.agent-status').textContent = 'Firing...';

    // Blog agent calls real n8n webhook
    if (m.id === 'blog') {
      try {
        const keyword = state.stageOutputs[3]
          ? state.stageOutputs[3].match(/\*\*(.*?)\*\*/)?.[1] || 'local business services'
          : 'local business services';

        const res = await fetch(N8N_BLOG_WEBHOOK, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            clientName:  state.name,
            clientUrl:   state.url,
            keyword:     keyword,
            industry:    state.stageOutputs[1]?.slice(0, 100) || 'local business',
            location:    'Ontario',
            gapAnalysis: state.stageOutputs[4] || '',
            keywords:    state.stageOutputs[3] || ''
          })
        });

        const data = await res.json();

        if (data.success && data.docUrl) {
          card.className = 'agent-card live';
          card.querySelector('.agent-status').textContent = 'Live â€” Article Written';
          document.getElementById('task-' + m.id).innerHTML =
            `âœ… 1,000+ word SEO article complete<br>
             <a href="${data.docUrl}" target="_blank"
                style="color:var(--teal);font-family:monospace;font-size:10px;word-break:break-all">
               ğŸ“„ ${data.title || 'View Google Doc â†’'}
             </a>`;
        } else {
          card.className = 'agent-card live';
          card.querySelector('.agent-status').textContent = 'Live';
        }
      } catch(e) {
        card.className = 'agent-card live';
        card.querySelector('.agent-status').textContent = 'Live';
      }
    } else {
      // Other agents â€” animate with delay
      await sleep(1000);
      card.className = 'agent-card live';
      card.querySelector('.agent-status').textContent = 'Live';
    }

    i++;
    await sleep(400);
  }

  // All done
  await sleep(600);
  document.getElementById('liveBanner').style.display = 'block';
  document.getElementById('liveTitle').textContent = state.name + ' is live.';
  setStatus('ready', 'Client Live');
  document.getElementById('statusDot').style.background = 'var(--teal)';
  document.getElementById('statusDot').style.boxShadow  = '0 0 8px var(--teal)';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setProgress(pct) { document.getElementById('progBar').style.width = pct + '%'; }

function setStatus(state, label) {
  const dot = document.getElementById('statusDot');
  const txt = document.getElementById('statusTxt');
  txt.textContent = label;
  if (state === 'running') {
    dot.style.background  = 'var(--gold)';
    dot.style.boxShadow   = '0 0 8px var(--gold)';
  } else {
    dot.style.background  = 'var(--green)';
    dot.style.boxShadow   = '0 0 8px var(--green)';
  }
}


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FIRE BLOG AGENT â€” DEMO BUTTON
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fireBlogAgent() {
  const btn = document.getElementById('fireBlogBtn');
  const firing = document.getElementById('blogFiring');
  const result = document.getElementById('blogResult');

  btn.disabled = true;
  btn.textContent = 'Firing...';
  btn.style.background = 'var(--muted2)';
  firing.style.display = 'block';
  result.style.display = 'none';

  try {
    const res = await fetch('https://camrae.app.n8n.cloud/webhook/groundwork-blog-agent', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        clientName:  state.name || 'Trending Home',
        clientUrl:   state.url  || 'trendinghome.com',
        keyword:     'solid wood countertops Ontario',
        industry:    'wood countertops',
        location:    'Ontario',
        gapAnalysis: state.stageOutputs[4] || '',
        keywords:    state.stageOutputs[3] || ''
      })
    });

    const data = await res.json();
    firing.style.display = 'none';

    if (data.success !== false) {
      document.getElementById('blogResultTitle').textContent = data.title || 'Article complete';
      document.getElementById('blogResultMeta').textContent = (data.wordCount || '1000+') + ' words written  |  Email sent to team inbox';
      result.style.display = 'block';
      btn.textContent = 'Agent Fired Successfully';
      btn.style.background = 'var(--green)';

      // Show live banner
      setTimeout(() => {
        document.getElementById('liveBanner').style.display = 'block';
        document.getElementById('liveTitle').textContent = (state.name || 'Client') + ' is live.';
      }, 1000);
    } else {
      btn.textContent = 'Fire Blog Agent Now';
      btn.style.background = 'var(--gold)';
      btn.disabled = false;
    }
  } catch(e) {
    firing.style.display = 'none';
    btn.textContent = 'Fire Blog Agent Now';
    btn.style.background = 'var(--gold)';
    btn.disabled = false;
    console.error(e);
  }
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

document.getElementById('urlInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && state.problem) startPipeline();
});
</script>
</body>
</html>
